<!doctype html>

<!--

    Welcome to the light side of the source, young padawan.

    One step closer to learn something interesting you are...

                               ____                  
                            _.' :  `._               
                        .-.'`.  ;   .'`.-.           
               __      / : ___\ ;  /___ ; \      __  
             ,'_ ""=-.:__;".-.";: :".-.":__;.-="" _`,
             :' `.t""=-.. '<@.`;_  ',@:` ..-=""j.' `;
                  `:-.._J '-.-'L__ `-.-' L_..-;'     
                    "-.__ ;  .-"  "-.  : __.-"       
                        L ' /.======.\ ' J           
                         "-.   "__"   .-"            
                        __.l"-:_JL_;-";.__           
                     .-j/'.;  ;""""  / .'\"-.        
                   .' /:`. "-.:     .-" .';  `.      
                .-"  / ;  "-. "-..-" .-"  :    "-.   
             .+"-.  : :      "-.__.-"      ;-._   \  
             ; \  `.; ;                    : : "+. ; 
             :  ;   ; ;                    : ;  : \: 
             ;  :   ; :                    ;:   ;  : 
            : \  ;  :  ;                  : ;  /  :: 
            ;  ; :   ; :                  ;   :   ;: 
            :  :  ;  :  ;                : :  ;  : ; 
            ;\    :   ; :                ; ;     ; ; 
            : `."-;   :  ;              :  ;    /  ; 
             ;    -:   ; :              ;  : .-"   : 
             :\     \  :  ;            : \.-"      : 
              ;`.    \  ; :            ;.'_..-=  / ; 
              :  "-.  "-:  ;          :/."      .'  :
               \         \ :          ;/  __        :
                \       .-`.\        /t-""  ":-+.   :
                 `.  .-"    `l    __/ /`. :  ; ; \  ;
                   \   .-" .-"-.-"  .' .'j \  /   ;/ 
                    \ / .-"   /.     .'.' ;_:'    ;  
                     :-""-.`./-.'     /    `.___.'   
                           \ `t  ._  /               
                            "-.t-._:'                

-->

<!--
    
    So you'd like to know how to use impress.js?
    
    You've made the first, very important step - you're reading the source code.
    And that's how impress.js presentations are built - with HTML and CSS code.
    
    Believe me, you need quite decent HTML and CSS skills to be able to use impress.js effectively.
    And what is even more important, you need to be a designer, too, because there are no default
    styles for impress.js presentations, there is no default or automatic layout for them.
    
    You need to design and build it by hand.
    
    So...
    
    Would you still like to know how to use impress.js?
    
-->

<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=1300" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <title>Git Plumbing</title>
    
    <meta name="description" content="Git plumbing is the low level internals of git" />
    <meta name="author" content="Jordan Evans" />


    <!--
        
        Impress.js doesn't depend on any external stylesheet. Script adds all styles it needs for
        presentation to work.
        
        This style below contains styles only for demo presentation. Browse it to see how impress.js
        classes are used to style presentation steps, or how to apply fallback styles, but I don't want
        you to use them directly in your presentation.
        
        Be creative, build your own. We don't really want all impress.js presentations to look the same,
        do we?
        
        When creating your own presentation get rid of this file. Start from scratch, it's fun!
        
    -->
    <link href="css/default.css" rel="stylesheet" />
    <link href="css/font.css" rel="stylesheet" />
    <link href="css/sunburst.css" rel="stylesheet" />
    
    <link rel="shortcut icon" href="favicon.png" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png" />
</head>

<!--
    
    Body element is used by impress.js to set some useful class names, that will allow you to detect
    the support and state of the presentation in CSS or other scripts.
    
    First very useful class name is `impress-not-supported`. This class means, that browser doesn't
    support features required by impress.js, so you should apply some fallback styles in your CSS.
    It's not necessary to add it manually on this element. If the script detects that browser is not
    good enough it will add this class, but keeping it in HTML means that users without JavaScript
    will also get fallback styles.
    
    When impress.js script detects that browser supports all required features, this class name will
    be removed.
    
    The class name on body element also depends on currently active presentation step. More details about
    it can be found later, when `hint` element is being described.
    
-->
<body class="impress-not-supported">

<!--
    For example this fallback message is only visible when there is `impress-not-supported` class on body.
-->
<div class="fallback-message">
    <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
    <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
</div>

<!--
    
    Now that's the core element used by impress.js.
    
    That's the wrapper for your presentation steps. In this element all the impress.js magic happens.
    It doesn't have to be a `<div>`. Only `id` is important here as that's how the script find it.
    
    You probably won't need it now, but there are some configuration options that can be set on this element.
    
    To change the duration of the transition between slides use `data-transition-duration="2000"` giving it
    a number of ms. It defaults to 1000 (1s).
    
    You can also control the perspective with `data-perspective="500"` giving it a number of pixels.
    It defaults to 1000. You can set it to 0 if you don't want any 3D effects.
    If you are willing to change this value make sure you understand how CSS perspective works:
    https://developer.mozilla.org/en/CSS/perspective
    
    But as I said, you won't need it for now, so don't worry - there are some simple but interesing things
    right around the corner of this tag ;)
    
-->
<div id="impress">

    <!--
        
        Here is where interesting thing start to happen.
        
        Each step of the presentation should be an element inside the `#impress` with a class name
        of `step`. These step elements are positioned, rotated and scaled by impress.js, and
        the 'camera' shows them on each step of the presentation.
        
        Positioning information is passed through data attributes.
        
        In the example below we only specify x and y position of the step element with `data-x="-1000"`
        and `data-y="-1500` attributes. This means that **the center** of the element (yes, the center)
        will be positioned in point x = -1000px and y = -1500px of the presentation 'canvas'.
        
        It will not be rotated or scaled.
        
    -->
    <div id="introduction" class="step slide" data-x="-1000" data-y="-1500">
        <h1>Git</h1>
        <h2>Porcelain and Plumbing</h2>
    </div>

    <!--
        
        The `id` attribute of the step element is used to identify it in the URL, but it's optional.
        If it is not defined, it will get a default value of `step-N` where N is a number of slide.
        
        So in the example below it'll be `step-2`.
        
        The hash part of the url when this step is active will be `#/step-2`.
        
        You can also use `#step-2` in a link, to point directly to this particular step.
        
        Please note, that while `#/step-2` (with slash) would also work in a link it's not recommended.
        Using classic `id`-based links like `#step-2` makes these links usable also in fallback mode.
        
    -->
    <div class="step slide" data-x="0" data-y="-1500">
        <h1>Hashes</h1>
        <p>Input: basically a string</p>
        <p>Output: fixed-size number</p>
        <p>Deterministic</p>
        <p>NOT Unique</p>
        <p>Low probability of collisions</p>
        <p>Fast</p>
        <p>Typically represented by hexadecimal string</p>
        <p>Git uses SHA-1, a 160 bit hash</p>
    </div>

    <div class="step slide" data-x="1000" data-y="-1500">
        <h1>Probability of Hash Collision</h1>
        <p>N = number of possible hashes, (for SHA1 this is 2^160)</p>
        <p>k = number of existing hashes</p>
        <p>Probability of next hash colliding: </p><pre><code> 1/N * (1 + 2 + 3 + 4 + ... + k) = (k * (k - 1))/ (2 * N)</code></pre>
        <p>MaaS core repo has 129,000 hashes</p>
        <p>Probability of next MaaS hash colliding: </p><pre><code>So large python won't compute it with default types</code></pre>
        <pre><code>Approximately 1e-40</pre></code>
    </div>

    <div class="step slide" data-x="1500" data-y="-1500">
        <h1>A git hash collision has happened. Once.</h1>
        <p>https://twitter.com/bhearsum/status/360152893996793857</p>
        <p>It will likely never happen again in our lifetimes</p>
    </div>

    <div class="step slide" data-x="2000" data-y="-1500">
        <h1>Git Objects</h1>
        <p>One of: blob, tree, commit</p>
        <p>All objects have hashes (and all hashes in git correspond to an object)</p>
        <p>Objects are stored by their hash (more about this later)</p>
        <p>Fundamental building blocks of git</p>
    </div>

    <div class="step slide" data-x="2500" data-y="-1500">
        <h1>Low-level Tools</h1>
        <p>hash-object</p>
        <p>cat-file</p>
        <p>update-index</p>
        <p>write-tree</p>
        <p>commit-tree</p>
        <p>rev-list</p>
        <p>Read the git manpage for many more!</p>
    </div>

    <div class="step slide" data-x="3000" data-y="-1500">
        <h1>Git Blob</h1>
        <p>Stores data</p>
        <p>Plain text, binary; any kind of data</p>
        <p>Has no filename, is only referred to by hash</p>
    </div>

    <div class="step slide" data-x="3500" data-y="-1500">
        <h1>Git Blob Example</h1>
        <pre><code>jordane@ivysaur:~/tmp>mkdir git-test
jordane@ivasaur:~/tmp>cd git-test
jordane@ivysaur:~/tmp/git-test>git init
Initialized empty Git repository in /Users/jordane/tmp/.git/
jordane@ivysaur:~/tmp/git-test>echo "this is some file data" | git hash-object --stdin -w
f87773f78e5a5120c28bb2926c33eacc8330d2f8</pre></code>
        <p> This makes a new file in .git/objects</p>
        <pre><code>jordane@ivysaur:~/tmp/git-test>find .git/objects -type f
.git/objects/f8/7773f78e5a5120c28bb2926c33eacc8330d2f8</pre></code>
    </div>

    <div class="step slide" data-x="4000" data-y="-1500">
        <h1>Git Blob Example</h1>
        <p> Git objects are compressed with zlib. Lets decompress with zlib to find out what is inside!
        <pre><code>jordane@ivysaur:~/tmp/git-test>cat .git/objects/f8/7773f78e5a5120c28bb2926c33eacc8330d2f8 \
| python -c "import zlib,sys;print repr(zlib.decompress(sys.stdin.read()))"
'blob 23\x00this is some file data\n'</pre></code>
        <p>This deflates to</p>
        <pre><code>object-type data_lengthNULLdata</pre></code>
        <p>In other words, we make this git object ourselves, without git!</p>
    </div>

    <div class="step slide" data-x="4500" data-y="-1500">
        <h1>Git Blob Example</h1>
        <p>The hash of the object is then just the hash of the decompressed data</p>
        <pre><code>jordane@ivysaur:~/tmp/git-test>echo "blob 23\x00this is some file data" | sha1sum
f87773f78e5a5120c28bb2926c33eacc8330d2f8</pre></code>
        <p>Rather than deflating the object file, we can use git cat-file to view the object type and contents:</p>
        <pre><code>jordane@ivysaur:~/tmp/git-test>git cat-file -t f87773f78e5a5120c28bb2926c33eacc8330d2f8
blob
jordane@ivysaur:~/tmp/git-test>git cat-file -p f87773f78e5a5120c28bb2926c33eacc8330d2f8
this is some file data
jordane@ivysaur:~/tmp/git-test></pre></code>
    </div>

    <div class="step slide" data-x="5000" data-y="-1500">
        <h1>Git Trees</h1>
        <p>A tree is like a directory</p>
        <p>It lists blobs or other trees</p>
        <p>One line per git object, with object type, permissions, hash, name</p>
        <p>Permissions tell git how to represent the object in the real file system: executable or not, symlink or regular file, etc</p>
        <p>Typically trees are created from the index</p>
    </div>

    <div class="step slide" data-x="5500" data-y="-1500">
        <h1>Index</h1>
        <p>A tree from which commits are made</p>
        <p>Files, directories, and changes have to be added to it with git-add (porcelain) or git-update-index (plumbing)</p>
        <p>Exists in .git/index</p>
        <p>NOT the same as a working tree</p>
        <p>Generally is the tree of current HEAD + any staged changes</p>
    </div>

    <div class="step slide" data-x="6000" data-y="-1500">
        <h1>Working Tree</h1>
        <p>The files as they currently are in your local clone</p>
        <p>Not actually required to make a commit, but extremely difficult without it</p>
        <p>Often is similar to index, but not the same</p>
        <p>`git diff` returns the diff between index and working tree, by default</p>
    </div>

    <div class="step slide" data-x="6500" data-y="-1500">
        <h1>Commit from Index</h1>
        <pre><code>jordane@ivysaur:~/tmp/git-test>git update-index --add --cacheinfo 100644 \
f87773f78e5a5120c28bb2926c33eacc8330d2f8 some_path/filename
jordane@ivysaur:~/tmp/git-test>git ls-files
some_path/files
jordane@ivysaur:~/tmp/git-test>git write-tree # Turns index into a tree object
6ce4acd2e063f36bddf11c1c7ee9bf02178be70e
jordane@ivysaur:~/tmp/git-test>git commit-tree -m "initial commit" \
6ce4acd2e063f36bddf11c1c7ee9bf02178be70e # No parent commit, so no -p
ec5141f9cea7967e1078ed3e164f57db8999e229
jordane@ivysaur:~/tmp/git-test>git cat-file -t ec5141f9cea7967e1078ed3e164f57db8999e229
commit
jordane@ivysaur:~/tmp/git-test>git cat-file -p ec5141f9cea7967e1078ed3e164f57db8999e229
tree 6ce4acd2e063f36bddf11c1c7ee9bf02178be70e
author Jordan Evans <jordan.evans@rackspace.com> 1375200783 -0700
committer Jordan Evans <jordan.evans@rackspace.com> 1375200783 -0700

initial commit
jordane@ivysaur:~/tmp/git-test>ls -a
./ ../ .git/</pre></code>
    </div>

    <div class="step slide" data-x="7000" data-y="-1500">
        <h1>Copy Index to Working Tree</h1>
        <pre><code>jordane@ivysaur:~/tmp/git-test>git checkout-index --all
jordane@ivysaur:~/tmp/git-test>ls -a
./ ../ .git/ some_path/
jordane@ivysaur:~/tmp/git-test>ls some_path/
filename
jordane@ivysaur:~/tmp/git-test>cat some_path/filename
this is some file data
jordane@ivysaur:~/tmp/git-test>echo "this is some more file data" >> some_path/filename
jordane@ivysaur:~/tmp/git-test>git update-index some_path/filename
jordane@ivysaur:~/tmp/git-test>git write-tree
04b6cc642b8cee7e5d9a318a14a57b3063f08e7f
jordane@ivysaur:~/tmp/git-test>git commit-tree -m "second commit" \
-p ec5141f9cea7967e1078ed3e164f57db8999e229 04b6cc642b8cee7e5d9a318a14a57b3063f08e7f
71f5f0497d6b95889b1cd121b9ce55ed1e64bb5e
jordane@ivysaur:~/tmp/git-test>git cat-file -p 71f5f0497d6b95889b1cd121b9ce55ed1e64bb5e
tree 04b6cc642b8cee7e5d9a318a14a57b3063f08e7f
parent ec5141f9cea7967e1078ed3e164f57db8999e229
author Jordan Evans <jordan.evans@rackspace.com> 1375201842 -0700
committer Jordan Evans <jordan.evans@rackspace.com> 1375201842 -0700

second commit
</pre></code>
    </div>

    <div class="step slide" data-x="7500" data-y="-1500">
        <h1>Commits with Multiple Parents</h1>
        <pre><code>jordane@ivysaur:~/tmp/git-test>echo "this is the third line of data" >> some_path/filename
jordane@ivysaur:~/tmp/git-test>git update-index some_path/filename
jordane@ivysaur:~/tmp/git-test>git write-tree
6e5620b3e69fb7484c1c5685bed0b4f9d6a79ec3
jordane@ivysaur:~/tmp/git-test>git commit-tree -m "commits can have multiple parents" \
-p ec5141f9cea7967e1078ed3e164f57db8999e229 -p 71f5f0497d6b95889b1cd121b9ce55ed1e64bb5e \
6e5620b3e69fb7484c1c5685bed0b4f9d6a79ec3
25ba1efa398d45baf1a79c349ed7b178a40cc6d3
jordane@ivysaur:~/tmp/git-test>git cat-file -p 25ba1efa398d45baf1a79c349ed7b178a40cc6d3
tree 6e5620b3e69fb7484c1c5685bed0b4f9d6a79ec3
parent ec5141f9cea7967e1078ed3e164f57db8999e229
parent 71f5f0497d6b95889b1cd121b9ce55ed1e64bb5e
author Jordan Evans <jordan.evans@rackspace.com> 1375202309 -0700
committer Jordan Evans <jordan.evans@rackspace.com> 1375202309 -0700

commits can have multiple parents</pre></code>

    </div>

    <div class="step slide" data-x="8000" data-y="-1500">
        <h1>Multiple Parents</h1>
        <p>These are generally called merge commits, because they combine two branches in the tree</p>
        <p>The only rules are that the commit ancestry cannot form a directed cycle</p>
        <p>This means Git is just a Directed Acyclic Graph (DAG)</p>
        <p>Note that the merge commit we made makes little sense: it is incestuous</p>
        <p>This is okay, because it still forms a DAG</p>
    </div>


    <div class="step slide" data-x="8500" data-y="-1500">
        <h1>Git Refs</h1>
        <p>They are symbolic identifiers</p>
        <p>branches and tags</p>
        <p>Located in .git/refs/</p>
        <p>.git/HEAD usually points to a ref</p>
        <p>refs/heads (branches) point to a commit, and are updated as commits are added</p>
        <p>refs/tags (tags) always point to the same commit</p>
        <p>remote refs are stored in .git/refs/remotes/remote_name/</p>
        <p>Editing these files by hand is generally bad (git porcelain commands do it for you)</p>
    </div>

    <div class="step slide" data-x="9000" data-y="-1500">
        <h1>Git Refs</h1>
        <pre><code>jordane@ivysaur:~/tmp/git-test>cat .git/HEAD
ref: refs/heads/master
jordane@ivysaur:~/tmp/git-test>ls .git/refs/heads/
master
jordane@ivysaur:~/tmp/git-test>cat .git/refs/heads/master

jordane@ivysaur:~/tmp/git-test>echo "25ba1efa398d45baf1a79c349ed7b178a40cc6d3" \
> .git/refs/heads/master</pre></code>
        <p>We just set master to commit 25ba1efa398d45baf1a79c349ed7b178a40cc6d3 by hand</p>
        <p>There are even plumbing commands to work with refs</p>
        <p>git-update-ref, git-symbolic-ref</p>
    </div>

    <div class="step slide" data-x="9500" data-y="-1500">
        <h1>Rules of Git</h1>
        <p>Your commits cannot make a cycle</p>
        <p>But you can't even do this if you tried!</p>
        <p>There are no other rules in the tools of git plumbing</p>
    </div>

    <div class="step slide" data-x="10000" data-y="-1500">
        <h1>Questions?</h1>
    </div>

    <div class="step slide" data-x="10500" data-y="-1500">
        <h1>rev-list</h1>
        <p>Lists commit objects in reverse chronological order</p>
        <pre><code>jordane@ivysaur:~/tmp/git-test>git rev-list 25ba1efa398d45baf1a79c349ed7b178a40cc6d3
25ba1efa398d45baf1a79c349ed7b178a40cc6d3
71f5f0497d6b95889b1cd121b9ce55ed1e64bb5e
ec5141f9cea7967e1078ed3e164f57db8999e229</pre></code>
        <p>It can do many more complex cases: If you need a list of commits, rev-list can do it!</p>
    </div>

    <div class="step slide" data-x="11000" data-y="-1500">
        <h1>resources</h1>
        <p><a href="http://preshing.com/20110504/hash-collision-probabilities">hash collision</a></p>
        <p><a href="http://www.git-scm.com/book">pro git book</a></p>
        <p><a href="http://tom.preston-werner.com/2009/05/19/the-git-parable.html">Git parable</a></p>
    </div>
</div>
<script>
if ("ontouchstart" in document.documentElement) { 
    document.querySelector(".hint").innerHTML = "<p>Tap on the left or right to navigate</p>";
}
</script>

<script src="js/impress.js"></script>
<script>impress().init();</script>


</body>
</html>
